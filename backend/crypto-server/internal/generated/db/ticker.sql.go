// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: ticker.sql

package db

import (
	"context"
)

const createTicker = `-- name: CreateTicker :one
INSERT INTO tickers (
  exchange, symbol, price, volume, high, low, change_percent, timestamp
) VALUES (
  $1, $2, $3, $4, $5, $6, $7, $8
) RETURNING id, exchange, symbol, price, volume, high, low, change_percent, timestamp, created_at
`

type CreateTickerParams struct {
	Exchange      string  `json:"exchange"`
	Symbol        string  `json:"symbol"`
	Price         float64 `json:"price"`
	Volume        float64 `json:"volume"`
	High          float64 `json:"high"`
	Low           float64 `json:"low"`
	ChangePercent float64 `json:"change_percent"`
	Timestamp     int64   `json:"timestamp"`
}

func (q *Queries) CreateTicker(ctx context.Context, arg CreateTickerParams) (Ticker, error) {
	row := q.db.QueryRow(ctx, createTicker,
		arg.Exchange,
		arg.Symbol,
		arg.Price,
		arg.Volume,
		arg.High,
		arg.Low,
		arg.ChangePercent,
		arg.Timestamp,
	)
	var i Ticker
	err := row.Scan(
		&i.ID,
		&i.Exchange,
		&i.Symbol,
		&i.Price,
		&i.Volume,
		&i.High,
		&i.Low,
		&i.ChangePercent,
		&i.Timestamp,
		&i.CreatedAt,
	)
	return i, err
}

const getLatestTicker = `-- name: GetLatestTicker :one
SELECT id, exchange, symbol, price, volume, high, low, change_percent, timestamp, created_at FROM tickers
WHERE exchange = $1 AND symbol = $2
ORDER BY timestamp DESC
LIMIT 1
`

type GetLatestTickerParams struct {
	Exchange string `json:"exchange"`
	Symbol   string `json:"symbol"`
}

func (q *Queries) GetLatestTicker(ctx context.Context, arg GetLatestTickerParams) (Ticker, error) {
	row := q.db.QueryRow(ctx, getLatestTicker, arg.Exchange, arg.Symbol)
	var i Ticker
	err := row.Scan(
		&i.ID,
		&i.Exchange,
		&i.Symbol,
		&i.Price,
		&i.Volume,
		&i.High,
		&i.Low,
		&i.ChangePercent,
		&i.Timestamp,
		&i.CreatedAt,
	)
	return i, err
}

const listTickersByExchange = `-- name: ListTickersByExchange :many
SELECT DISTINCT ON (symbol) id, exchange, symbol, price, volume, high, low, change_percent, timestamp, created_at FROM tickers
WHERE exchange = $1
ORDER BY symbol, timestamp DESC
`

func (q *Queries) ListTickersByExchange(ctx context.Context, exchange string) ([]Ticker, error) {
	rows, err := q.db.Query(ctx, listTickersByExchange, exchange)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Ticker
	for rows.Next() {
		var i Ticker
		if err := rows.Scan(
			&i.ID,
			&i.Exchange,
			&i.Symbol,
			&i.Price,
			&i.Volume,
			&i.High,
			&i.Low,
			&i.ChangePercent,
			&i.Timestamp,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
